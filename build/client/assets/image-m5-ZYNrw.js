import{r as o,j as d}from"./jsx-runtime-CbkKSL4Y.js";import{c as B,a as j,n as P,u as C,B as D,I as H}from"./heading-D8Tt-9AR.js";import{u as q}from"./theme-provider-DjYxPUYU.js";function A(){const[e,t]=o.useState(!1);return o.useEffect(()=>{t(!0)},[]),e}function G(e,t,r={},a=!0){const[c,n]=o.useState(!1),[s,i]=o.useState(!1);return o.useEffect(()=>{if(!(e!=null&&e.current))return;const u=new IntersectionObserver(([l])=>{const{isIntersecting:m,target:p}=l;n(m),m&&t&&(u.unobserve(p),i(!0))},r);return!s&&a&&u.observe(e.current),()=>u.disconnect()},[e,t,r,s,a]),c}async function J({src:e,srcSet:t,sizes:r}){return new Promise((a,c)=>{try{if(!e&&!t)throw new Error("No image src or srcSet provided");let n=new Image;e&&(n.src=e),t&&(n.srcset=t),r&&(n.sizes=r);const s=()=>{n.removeEventListener("load",s);const i=n.currentSrc;n=null,a(i)};n.addEventListener("load",s)}catch(n){c(`Error loading ${t}: ${n}`)}})}async function K(e=1,t=1){return new Promise(r=>{const a=document.createElement("canvas"),c=a.getContext("2d");a.width=e,a.height=t,c.fillStyle="rgba(0, 0, 0, 0)",c.fillRect(0,0,e,t),a.toBlob(async n=>{if(!n)throw new Error("Video thumbnail failed to load");const s=URL.createObjectURL(n);a.remove(),r(s)})})}async function Q({srcSet:e,sizes:t}){const r=await Promise.all(e.split(", ").map(async s=>{const[i,u]=s.split(" "),l=Number(u.replace("w","")),m=await K(l);return{src:i,image:m,width:u}})),a=r.map(({image:s,width:i})=>`${s} ${i}`).join(", "),c=await J({srcSet:a,sizes:t});return r.find(s=>s.image===c).src}const X="_image_1yz75_3",Y="_container_1yz75_83",Z="_elementWrapper_1yz75_97",O="_placeholder_1yz75_141",ee="_element_1yz75_97",te="_button_1yz75_207",g={image:X,container:Y,elementWrapper:Z,placeholder:O,element:ee,button:te},oe=({className:e,style:t,reveal:r,delay:a=0,raised:c,src:n,srcSet:s,placeholder:i,...u})=>{const[l,m]=o.useState(!1),{theme:p}=q(),y=o.useRef(),v=n||s.split(" ")[0],_=G(y,!R(v)),S=o.useCallback(()=>{m(!0)},[]);return d.jsx("div",{className:B(g.image,e),"data-visible":_||l,"data-reveal":r,"data-raised":c,"data-theme":p,style:j({delay:P(a)},t),ref:y,children:d.jsx(se,{delay:a,onLoad:S,loaded:l,inViewport:_,reveal:r,src:v,srcSet:s,placeholder:i,...u})})},se=({onLoad:e,loaded:t,inViewport:r,srcSet:a,placeholder:c,delay:n,src:s,alt:i,play:u=!0,restartOnPause:l,reveal:m,sizes:p,width:y,height:v,noPauseButton:_,cover:S,...N})=>{const I=C(),[$,k]=o.useState(!0),[V,b]=o.useState(!I),[E,L]=o.useState(),[z,F]=o.useState(!1),T=o.useRef(),f=o.useRef(),h=R(s),M=r,U=A();o.useEffect(()=>{h&&a?(async()=>{const w=await Q({srcSet:a,sizes:p});L(w)})():h&&L(s)},[h,p,s,a]),o.useEffect(()=>{if(!f.current||!E)return;const x=()=>{b(!0),f.current.play()},w=()=>{b(!1),f.current.pause()};u||(w(),l&&(f.current.currentTime=0)),!z&&(r?r&&!I&&u&&x():w())},[r,u,I,l,z,E]);const W=x=>{x.preventDefault(),F(!0),f.current.paused?(b(!0),f.current.play()):(b(!1),f.current.pause())};return d.jsxs("div",{className:g.elementWrapper,"data-reveal":m,"data-visible":r||t,style:j({delay:P(n+1e3)}),children:[h&&U&&d.jsxs(o.Fragment,{children:[d.jsx("video",{muted:!0,loop:!0,playsInline:!0,className:g.element,"data-loaded":t,"data-cover":S,autoPlay:!I,onLoadStart:e,src:E,"aria-label":i,ref:f,...N}),!_&&d.jsxs(D,{className:g.button,onClick:W,children:[d.jsx(H,{icon:V?"pause":"play"}),V?"Pause":"Play"]})]}),!h&&d.jsx("img",{className:g.element,"data-loaded":t,"data-cover":S,onLoad:e,decoding:"async",src:M?s:void 0,srcSet:M?a:void 0,width:y,height:v,alt:i,sizes:p,...N}),$&&d.jsx("img",{"aria-hidden":!0,className:g.placeholder,"data-loaded":t,"data-cover":S,style:j({delay:P(n)}),ref:T,src:c,width:y,height:v,onTransitionEnd:()=>k(!1),decoding:"async",loading:"lazy",alt:"",role:"presentation"})]})};function R(e){return typeof e=="string"&&e.includes(".mp4")}export{oe as I,Q as r,G as u};
